<!DOCTYPE html>
<html lang="ru" data-theme="emerald">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Урицкая средняя школа</title>

  <!-- ШРИФТЫ -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&family=Russo+One&display=swap" rel="stylesheet">

  <!-- ВНЕШНИЙ CSS -->
  <link rel="stylesheet" href="assets/css/main.css">
</head>
<body>

  <!-- AURORA фон -->
  <div class="bg-canvas"></div>
  <div class="bg-pattern"></div>
  <div class="bg-noise"></div>

  <!-- ПЕРЕКЛЮЧАТЕЛЬ ТЕМЫ -->
  <button id="themeToggle" class="theme-toggle" aria-pressed="false" title="Переключить тему">
    <span class="dot" aria-hidden="true"></span><span id="themeLabel">Официальная тема</span>
  </button>

  <!-- HERO -->
  <header class="hero">
    <div class="inner fade">
      <!-- ГЕРБ СВЕРХУ -->
      <img class="hero-logo" src="assets/images/gerb.png" alt="Герб Республики Беларусь">
      <h1 class="title">Урицкая средняя школа</h1>
      <p class="subtitle">Что-то,где-то, зачем-то.</p>
      <nav class="topnav">
        <a href="news.html">События</a>
        <a href="#about">О школе</a>
        <a href="#contacts">Контакты</a>
      </nav>
    </div>
  </header>

  <!-- БЫСТРЫЕ КАРТОЧКИ -->
  <section>
    <div class="container">
      <h2 class="section-title fade">Быстрый доступ</h2>
      <div class="grid fade">
        <article class="card">
          <h3><a class="link-title" href="news.html">События</a></h3>
          <p>Будьте в курсе школьной жизни: олимпиады, праздники, конкурсы.</p>
        </article>

        <article class="card">
          <h3><a class="link-title" href="raspisanie.html">Расписание</a></h3>
          <p>Актуальные уроки и звонки.</p>
        </article>

        <article class="card">
          <h3><a class="link-title" href="teacher.html">Учителя</a></h3>
          <p>Команда профессионалов и классных руководителей.</p>
        </article>

        <article class="card">
          <h3><a class="link-title" href="admin-schedule.html">График работы администрации</a></h3>
          <p>Часы приёма директора и заместителей.</p>
        </article>

        <article class="card">
          <h3>Для законных представителей</h3>
          <p>Важные материалы и сервисы.</p>
          <div class="submenu-card">
            <a href="dress-code.html">Деловой стиль одежды</a>
            <a href="gpd.html">ГПД</a>
            <a href="open-reception.html">Открытая приёмная</a>
            <a href="recommendations.html">Рекомендации законным представителям</a>
            <a href="parent-meetings.html">Родительские собрания</a>
            <a href="belgosstrakh.html">Белгострах напоминает</a>
            <a href="future-firstgraders.html">Школа будущих первоклассников</a>
          </div>
        </article>

        <article class="card">
          <h3>Для обучающихся</h3>
          <p>Важная информация.</p>
          <div class="submenu-card">
            <a href="dress-code.html">Деловой стиль одежды</a>
            <a href="gpd.html">Требования к дневникам</a>
            <a href="open-reception.html">Профильное обучение</a>
            <a href="recommendations.html">Олимпиады</a>
            <a href="parent-meetings.html">Добавим потом</a>
            <a href="belgosstrakh.html">ПОтом добавим</a>
            <a href="future-firstgraders.html">Еще позже</a>
          </div>
        </article>
      </div>
    </div>
  </section>

  <!-- СОБЫТИЯ -->
  <section id="events">
    <div class="container">
      <h2 class="section-title fade">Последние события</h2>
      <div id="latest-news" class="grid fade"></div>

      <p style="text-align:center;margin-top:14px">
        <a href="news.html" class="btn">Показать все события</a>
      </p>

      <p id="latest-error" style="color:var(--muted);display:none;margin-top:8px">Не удалось загрузить новости.</p>
    </div>
  </section>

  <!-- О ШКОЛЕ -->
  <section id="about">
    <div class="container">
      <h2 class="section-title fade">О школе</h2>
      <ul class="about-list fade">
        <li><span>Адрес</span><b>Тенистая ул., 10, агрогородок Урицкое</b></li>
        <li><span>Телефон</span><b><a href="tel:+375232985102" style="color:var(--accent);text-decoration:none">+375 23 298-51-02</a></b></li>
        <li><span>Учащиеся</span><b>900+ школьников</b></li>
        <li><span>Подход</span><b>Традиции + современные практики</b></li>
      </ul>
    </div>
  </section>

  <!-- ФУТЕР -->
  <footer id="contacts">
    <p class="credit">
      <a href="https://reklama322228.netlify.app/" target="_blank" rel="noopener">
        <img src="assets/icons/logo 4.png" alt="ЕТ" width="80" height="80" style="vertical-align:-3px;margin-right:6px;">
      </a>
    </p>
    <p>
      Адрес: Тенистая ул., 10, агрогородок Урицкое · 
      Тел.: <a href="tel:+375232985102">+375 23 298-51-02</a>
    </p>
  </footer>

  <!-- ПЛАВАЮЩИЕ ИКОНКИ -->
  <div class="dock" aria-label="Соцсети">
    <div class="group">
      <a class="fab" href="https://t.me/uritskoe_school" target="_blank" aria-label="Telegram">
        <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24" width="26" height="26">
          <path d="M12 2c5.52 0 10 4.48 10 10s-4.48 10-10 10S2 17.52 2 12 6.48 2 12 2zm3.5 6.56-8.06 3.18c-.55.22-.55.53-.1.66l2.06.65 4.77-3c.22-.15.43-.07.26.1l-3.86 3.65-.14 2.06c.2 0 .29-.09.4-.2l.98-.94 2.03 1.5c.38.2.65.1.74-.35l1.35-6.55c.12-.6-.23-.87-.73-.66z"/>
        </svg>
      </a>
      <div class="label">Telegram</div>
    </div>

    <div class="group">
      <a class="fab" href="https://www.instagram.com/uritskaya_schkola/" target="_blank" aria-label="Instagram">
        <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24" width="26" height="26">
          <path d="M7 2C4.24 2 2 4.24 2 7v10c0 2.76 2.24 5 5 5h10c2.76 0 5-2.24 5-5V7c0-2.76-2.24-5-5-5H7zm10 2c1.66 0 3 1.34 3 3v10c0 1.66-1.34 3-3 3H7c-1.66 0-3-1.34-3-3V7c0-1.66 1.34-3 3-3h10zm-5 3a5 5 0 1 0 0 10 5 5 0 0 0 0-10zm0 2a3 3 0 1 1 0 6 3 3 0 0 1 0-6zm4.5-.75a1.25 1.25 0 1 1 0 2.5 1.25 1.25 0 0 1 0-2.5z"/>
        </svg>
      </a>
      <div class="label">Instagram</div>
    </div>
  </div>

  <script>
    // ====== ТЕМА: загрузка/переключение/сохранение ======
    (function(){
      const el = document.documentElement;
      const btn = document.getElementById('themeToggle');
      const label = document.getElementById('themeLabel');
      const KEY = 'site-theme';
      const saved = localStorage.getItem(KEY);
      const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
      const initial = saved || (prefersDark ? 'dark' : 'emerald');
      el.setAttribute('data-theme', initial);
      updateBtn(initial);

      btn.addEventListener('click', ()=>{
        const curr = el.getAttribute('data-theme');
        const next = (curr === 'dark') ? 'emerald' : 'dark';
        el.setAttribute('data-theme', next);
        localStorage.setItem(KEY, next);
        updateBtn(next);
      });
      function updateBtn(theme){
        label.textContent = theme === 'dark' ? 'Тёмная тема' : 'Официальная тема';
        btn.setAttribute('aria-pressed', theme !== 'dark');
      }
    })();

    // плавные появления секций
    const fades = document.querySelectorAll('.fade');
    const io = new IntersectionObserver(es => {
      es.forEach(e=>{ if(e.isIntersecting) e.target.classList.add('show'); });
    }, {threshold:.2});
    fades.forEach(n=>io.observe(n));

    // раскрытие карточек по тапу, не ломаем ссылки
    document.querySelectorAll('.card').forEach(card=>{
      card.addEventListener('click', (e)=>{
        if(e.target.closest('a')) return;
        card.classList.toggle('open');
      });
      document.addEventListener('click', (e)=>{
        if(!card.contains(e.target)) card.classList.remove('open');
      });
    });

    // последние новости из GitHub
    (function(){
      const BOX = document.getElementById('latest-news');
      const ERR = document.getElementById('latest-error');
      const REPO_OWNER = "Lyrielochka";
      const REPO_NAME  = "school-site";
      const BRANCH     = "main";
      const API_LIST = `https://api.github.com/repos/${REPO_OWNER}/${REPO_NAME}/contents/news?ref=${BRANCH}`;
      const RAW_FILE  = (name)=>`https://raw.githubusercontent.com/${REPO_OWNER}/${REPO_NAME}/${BRANCH}/news/${encodeURIComponent(name)}`;

      function parseFrontMatter(md){
        const m = md.match(/^---\s*([\s\S]*?)\s*---\s*([\s\S]*)$/);
        if(!m) return {meta:{}, body:md};
        const yaml = m[1], body = m[2], meta = {};
        yaml.split(/\r?\n/).forEach(line=>{
          const mm = line.match(/^(\w+):\s*(.*)$/);
          if(mm){
            const k=mm[1].trim(); let v=mm[2].trim();
            if(/^".*"$/.test(v)||/^'.*'$/.test(v)) v=v.slice(1,-1);
            meta[k]=v;
          }
        });
        return {meta, body};
      }
      const fmtDate = s => { try { return new Date(s).toLocaleDateString('ru-RU',{year:'numeric',month:'long',day:'2-digit'}); } catch { return s; } };

      async function loadLatest(){
        try{
          const res = await fetch(API_LIST);
          if(!res.ok) throw res;
          const files = await res.json();
          const mdFiles = files.filter(f=>/\.md$/i.test(f.name));
          const raws = await Promise.all(mdFiles.map(f=>fetch(RAW_FILE(f.name)).then(r=>r.text().then(t=>({name:f.name, text:t})))));

          let items = raws.map(({name,text})=>{
            const {meta, body} = parseFrontMatter(text);
            const firstLine = (body.split('\n').find(l=>l.trim())||"").trim();
            return {
              file: name,
              title: meta.title || name.replace(/\.md$/,''),
              date:  meta.date || "",
              cover: meta.cover || "",
              excerpt: meta.excerpt || (firstLine.length>140? firstLine.slice(0,140)+'…' : firstLine)
            };
          }).sort((a,b)=> new Date(b.date)-new Date(a.date)).slice(0,3);

          BOX.innerHTML = items.map(it=>`
            <article class="event" style="overflow:hidden">
              ${it.cover ? `
                <img src="${it.cover}" alt="" loading="lazy"
                     style="width:100%;height:160px;object-fit:cover;border-radius:10px;border:1px solid var(--line);margin-bottom:10px">
              ` : ``}
              <h3 style="color:var(--accent);margin:0">${it.title}</h3>
              ${it.date ? `<small>${fmtDate(it.date)}</small>` : ``}
              ${it.excerpt ? `<p style="margin-top:6px">${it.excerpt}</p>` : ``}
              <p style="margin-top:8px"><a href="news.html?slug=${encodeURIComponent(it.file)}" style="color:var(--accent);text-decoration:none">Читать полностью →</a></p>
            </article>
          `).join('');
        }catch(e){
          console.error(e); ERR.style.display = '';
        }
      }
      loadLatest();
    })();
  </script>
</body>
</html>
